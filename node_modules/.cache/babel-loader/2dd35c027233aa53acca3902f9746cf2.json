{"remainingRequest":"/Users/alex/Documents/HS/basketballbackend/node_modules/babel-loader/lib/index.js!/Users/alex/Documents/HS/basketballbackend/src/permission.js","dependencies":[{"path":"/Users/alex/Documents/HS/basketballbackend/src/permission.js","mtime":1667646571761},{"path":"/Users/alex/Documents/HS/basketballbackend/node_modules/cache-loader/dist/cjs.js","mtime":1662170097529},{"path":"/Users/alex/Documents/HS/basketballbackend/node_modules/babel-loader/lib/index.js","mtime":1662170097912}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1VzZXJzL2FsZXgvRG9jdW1lbnRzL0hTL2Jhc2tldGJhbGxiYWNrZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IHsgTG9hZGluZ0JhciB9IGZyb20gJ3ZpZXctZGVzaWduJzsKaW1wb3J0IGNyZWF0ZVJvdXRlcyBmcm9tICdAL3V0aWxzL2NyZWF0ZVJvdXRlcyc7CmltcG9ydCByb3V0ZXIgZnJvbSAnLi9yb3V0ZXInOwppbXBvcnQgc3RvcmUgZnJvbSAnLi9zdG9yZSc7CmltcG9ydCB7IGdldERvY3VtZW50VGl0bGUsIHJlc2V0VG9rZW5BbmRDbGVhclVzZXIgfSBmcm9tICcuL3V0aWxzJzsgLy8g5piv5ZCm5pyJ6I+c5Y2V5pWw5o2uCgp2YXIgaGFzTWVudXMgPSBmYWxzZTsKcm91dGVyLmJlZm9yZUVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodG8sIGZyb20sIG5leHQpIHsKICAgIHZhciByb3V0ZXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZ2V0RG9jdW1lbnRUaXRsZSh0by5tZXRhLnRpdGxlKTsKICAgICAgICAgICAgTG9hZGluZ0Jhci5zdGFydCgpOwoKICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpKSB7CiAgICAgICAgICAgICAgaWYgKHRvLnBhdGggPT09ICcvbG9naW4nKSB7CiAgICAgICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICAgICAgcGF0aDogJy8nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc01lbnVzKSB7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJiZWZvcmUsIHJvdXRlciIsIHJvdXRlcik7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgLy8g6L+Z6YeM5Y+v5Lul55SoIGF3YWl0IOmFjeWQiOivt+axguWQjuWPsOaVsOaNruadpeeUn+aIkOi3r+eUsQogICAgICAgICAgICAgICAgICAvLyBjb25zdCBkYXRhID0gYXdhaXQgYXhpb3MuZ2V0KCd4eHgnKQogICAgICAgICAgICAgICAgICAvLyBjb25zdCByb3V0ZXMgPSBjcmVhdGVSb3V0ZXMoZGF0YSkKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc3RvcmUuc3RhdGUubWVudUl0ZW1zKTsKICAgICAgICAgICAgICAgICAgcm91dGVzID0gY3JlYXRlUm91dGVzKHN0b3JlLnN0YXRlLm1lbnVJdGVtcyk7IC8vIOWKqOaAgea3u+WKoOi3r+eUsQoKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImFhYWFhYWFhYSIsIHJvdXRlcyk7CiAgICAgICAgICAgICAgICAgIHJvdXRlci5hZGRSb3V0ZXMocm91dGVzKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coInd6enosIHJvdXRlciIsIHJvdXRlcik7CiAgICAgICAgICAgICAgICAgIGhhc01lbnVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogdG8ucGF0aCB8fCAnLycKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICByZXNldFRva2VuQW5kQ2xlYXJVc2VyKCk7CiAgICAgICAgICAgICAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGhhc01lbnVzID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmICh0by5wYXRoID09PSAnL2xvZ2luJykgewogICAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXh0KCIvbG9naW4/cmVkaXJlY3Q9Ii5jb25jYXQodG8ucGF0aCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIExvYWRpbmdCYXIuZmluaXNoKCk7Cn0pOw=="},{"version":3,"sources":["/Users/alex/Documents/HS/basketballbackend/src/permission.js"],"names":["LoadingBar","createRoutes","router","store","getDocumentTitle","resetTokenAndClearUser","hasMenus","beforeEach","to","from","next","document","title","meta","start","localStorage","getItem","path","console","log","state","menuItems","routes","addRoutes","error","afterEach","finish"],"mappings":";;AAAA,SAASA,UAAT,QAA2B,aAA3B;AACA,OAAOC,YAAP,MAAyB,sBAAzB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,gBAAT,EAA2BC,sBAA3B,QAAyD,SAAzD,C,CAEA;;AACA,IAAIC,QAAQ,GAAG,KAAf;AACAJ,MAAM,CAACK,UAAP;AAAA,qEAAkB,iBAAOC,EAAP,EAAWC,IAAX,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AACdC,YAAAA,QAAQ,CAACC,KAAT,GAAiBR,gBAAgB,CAACI,EAAE,CAACK,IAAH,CAAQD,KAAT,CAAjC;AACAZ,YAAAA,UAAU,CAACc,KAAX;;AACA,gBAAIC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAJ,EAAmC;AAC/B,kBAAIR,EAAE,CAACS,IAAH,KAAY,QAAhB,EAA0B;AACtBP,gBAAAA,IAAI,CAAC;AAAEO,kBAAAA,IAAI,EAAE;AAAR,iBAAD,CAAJ;AACH,eAFD,MAEO,IAAIX,QAAJ,EAAc;AACjBI,gBAAAA,IAAI;AACP,eAFM,MAEA;AACHQ,gBAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BjB,MAA9B;;AACA,oBAAI;AACA;AACA;AACA;AACAgB,kBAAAA,OAAO,CAACC,GAAR,CAAYhB,KAAK,CAACiB,KAAN,CAAYC,SAAxB;AACMC,kBAAAA,MALN,GAKerB,YAAY,CAACE,KAAK,CAACiB,KAAN,CAAYC,SAAb,CAL3B,EAMA;;AACAH,kBAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBG,MAAzB;AACApB,kBAAAA,MAAM,CAACqB,SAAP,CAAiBD,MAAjB;AACAJ,kBAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BjB,MAA5B;AACAI,kBAAAA,QAAQ,GAAG,IAAX;AACAI,kBAAAA,IAAI,CAAC;AAAEO,oBAAAA,IAAI,EAAET,EAAE,CAACS,IAAH,IAAW;AAAnB,mBAAD,CAAJ;AACH,iBAZD,CAYE,OAAOO,KAAP,EAAc;AACZnB,kBAAAA,sBAAsB;AACtBK,kBAAAA,IAAI,2BAAoBF,EAAE,CAACS,IAAvB,EAAJ;AACH;AACJ;AACJ,aAxBD,MAwBO;AACHX,cAAAA,QAAQ,GAAG,KAAX;;AACA,kBAAIE,EAAE,CAACS,IAAH,KAAY,QAAhB,EAA0B;AACtBP,gBAAAA,IAAI;AACP,eAFD,MAEO;AACHA,gBAAAA,IAAI,2BAAoBF,EAAE,CAACS,IAAvB,EAAJ;AACH;AACJ;;AAlCa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA;AAqCAf,MAAM,CAACuB,SAAP,CAAiB,YAAM;AACnBzB,EAAAA,UAAU,CAAC0B,MAAX;AACH,CAFD","sourcesContent":["import { LoadingBar } from 'view-design'\nimport createRoutes from '@/utils/createRoutes'\nimport router from './router'\nimport store from './store'\nimport { getDocumentTitle, resetTokenAndClearUser } from './utils'\n\n// 是否有菜单数据\nlet hasMenus = false\nrouter.beforeEach(async (to, from, next) => {\n    document.title = getDocumentTitle(to.meta.title)\n    LoadingBar.start()\n    if (localStorage.getItem('token')) {\n        if (to.path === '/login') {\n            next({ path: '/' })\n        } else if (hasMenus) {\n            next()\n        } else {\n            console.log(\"before, router\", router)\n            try {\n                // 这里可以用 await 配合请求后台数据来生成路由\n                // const data = await axios.get('xxx')\n                // const routes = createRoutes(data)\n                console.log(store.state.menuItems)\n                const routes = createRoutes(store.state.menuItems)\n                // 动态添加路由\n                console.log(\"aaaaaaaaa\", routes)\n                router.addRoutes(routes)\n                console.log(\"wzzz, router\", router)\n                hasMenus = true\n                next({ path: to.path || '/' })\n            } catch (error) {\n                resetTokenAndClearUser()\n                next(`/login?redirect=${to.path}`)\n            }\n        }\n    } else {\n        hasMenus = false\n        if (to.path === '/login') {\n            next()\n        } else {\n            next(`/login?redirect=${to.path}`)\n        }\n    }\n})\n\nrouter.afterEach(() => {\n    LoadingBar.finish()\n})"]}]}