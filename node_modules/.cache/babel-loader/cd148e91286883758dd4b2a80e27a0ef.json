{"remainingRequest":"/Users/alex/Documents/HS/basketballbackend/node_modules/babel-loader/lib/index.js!/Users/alex/Documents/HS/basketballbackend/src/permission.js","dependencies":[{"path":"/Users/alex/Documents/HS/basketballbackend/src/permission.js","mtime":1667649292685},{"path":"/Users/alex/Documents/HS/basketballbackend/node_modules/cache-loader/dist/cjs.js","mtime":1662170097529},{"path":"/Users/alex/Documents/HS/basketballbackend/node_modules/babel-loader/lib/index.js","mtime":1662170097912}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL1VzZXJzL2FsZXgvRG9jdW1lbnRzL0hTL2Jhc2tldGJhbGxiYWNrZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IHsgTG9hZGluZ0JhciB9IGZyb20gJ3ZpZXctZGVzaWduJzsKaW1wb3J0IGNyZWF0ZVJvdXRlcyBmcm9tICdAL3V0aWxzL2NyZWF0ZVJvdXRlcyc7CmltcG9ydCByb3V0ZXIgZnJvbSAnLi9yb3V0ZXInOwppbXBvcnQgc3RvcmUgZnJvbSAnLi9zdG9yZSc7CmltcG9ydCB7IGdldERvY3VtZW50VGl0bGUsIHJlc2V0VG9rZW5BbmRDbGVhclVzZXIgfSBmcm9tICcuL3V0aWxzJzsKaW1wb3J0IGNsb3VkYmFzZSBmcm9tICdAY2xvdWRiYXNlL2pzLXNkayc7IC8vIOaYr+WQpuacieiPnOWNleaVsOaNrgoKdmFyIGFwcCA9IGNsb3VkYmFzZS5pbml0KHsKICBlbnY6ICd0ZXN0LTdnZ3lwa3BuMGRkNDcxYmEnCn0pOwp2YXIgYXV0aCA9IGFwcC5hdXRoKHsKICBwZXJzaXN0ZW5jZTogJ2xvY2FsJwp9KTsKCmlmIChhdXRoLmhhc0xvZ2luU3RhdGUoKSkgewogIGNvbnNvbGUubG9nKCdoYXNsb2dpbicpOyAvLyDmraTml7blt7Lnu4/nmbvlvZUKfSBlbHNlIHsKICBjb25zb2xlLmxvZygnaGFzIG5vdCBsb2dpbicpOwp9Cgp2YXIgaGFzTWVudXMgPSBmYWxzZTsKcm91dGVyLmJlZm9yZUVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodG8sIGZyb20sIG5leHQpIHsKICAgIHZhciByb3V0ZXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZ2V0RG9jdW1lbnRUaXRsZSh0by5tZXRhLnRpdGxlKTsKICAgICAgICAgICAgTG9hZGluZ0Jhci5zdGFydCgpOwoKICAgICAgICAgICAgaWYgKGF1dGguaGFzTG9naW5TdGF0ZSgpKSB7CiAgICAgICAgICAgICAgaWYgKHRvLnBhdGggPT09ICcvbG9naW4nKSB7CiAgICAgICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICAgICAgcGF0aDogJy8nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc01lbnVzKSB7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIC8vIOi/memHjOWPr+S7peeUqCBhd2FpdCDphY3lkIjor7fmsYLlkI7lj7DmlbDmja7mnaXnlJ/miJDot6/nlLEKICAgICAgICAgICAgICAgICAgLy8gY29uc3QgZGF0YSA9IGF3YWl0IGF4aW9zLmdldCgneHh4JykKICAgICAgICAgICAgICAgICAgLy8gY29uc3Qgcm91dGVzID0gY3JlYXRlUm91dGVzKGRhdGEpCiAgICAgICAgICAgICAgICAgIHJvdXRlcyA9IGNyZWF0ZVJvdXRlcyhzdG9yZS5zdGF0ZS5tZW51SXRlbXMpOwogICAgICAgICAgICAgICAgICByb3V0ZXIuYWRkUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgICAgICAgIGhhc01lbnVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogdG8ucGF0aCB8fCAnLycKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICBhdXRoLnNpZ25PdXQoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygic2lnbiBvdXQiKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJlc2V0VG9rZW5BbmRDbGVhclVzZXIoKTsKICAgICAgICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaGFzTWVudXMgPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKHRvLnBhdGggPT09ICcvbG9naW4nKSB7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCwgX3gyLCBfeDMpIHsKICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpKTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgTG9hZGluZ0Jhci5maW5pc2goKTsKfSk7"},{"version":3,"sources":["/Users/alex/Documents/HS/basketballbackend/src/permission.js"],"names":["LoadingBar","createRoutes","router","store","getDocumentTitle","resetTokenAndClearUser","cloudbase","app","init","env","auth","persistence","hasLoginState","console","log","hasMenus","beforeEach","to","from","next","document","title","meta","start","path","routes","state","menuItems","addRoutes","error","signOut","then","afterEach","finish"],"mappings":";;AAAA,SAASA,UAAT,QAA2B,aAA3B;AACA,OAAOC,YAAP,MAAyB,sBAAzB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,gBAAT,EAA2BC,sBAA3B,QAAyD,SAAzD;AACA,OAAOC,SAAP,MAAsB,mBAAtB,C,CAEA;;AAEA,IAAMC,GAAG,GAAGD,SAAS,CAACE,IAAV,CAAe;AACvBC,EAAAA,GAAG,EAAE;AADkB,CAAf,CAAZ;AAGA,IAAMC,IAAI,GAAGH,GAAG,CAACG,IAAJ,CAAS;AAClBC,EAAAA,WAAW,EAAE;AADK,CAAT,CAAb;;AAGA,IAAID,IAAI,CAACE,aAAL,EAAJ,EAA0B;AACtBC,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EADsB,CAEtB;AACH,CAHD,MAGO;AACHD,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH;;AAED,IAAIC,QAAQ,GAAG,KAAf;AACAb,MAAM,CAACc,UAAP;AAAA,qEAAkB,iBAAOC,EAAP,EAAWC,IAAX,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AACdC,YAAAA,QAAQ,CAACC,KAAT,GAAiBjB,gBAAgB,CAACa,EAAE,CAACK,IAAH,CAAQD,KAAT,CAAjC;AACArB,YAAAA,UAAU,CAACuB,KAAX;;AACA,gBAAIb,IAAI,CAACE,aAAL,EAAJ,EAA0B;AACtB,kBAAIK,EAAE,CAACO,IAAH,KAAY,QAAhB,EAA0B;AACtBL,gBAAAA,IAAI,CAAC;AAAEK,kBAAAA,IAAI,EAAE;AAAR,iBAAD,CAAJ;AACH,eAFD,MAEO,IAAIT,QAAJ,EAAc;AACjBI,gBAAAA,IAAI;AACP,eAFM,MAEA;AACH,oBAAI;AACA;AACA;AACA;AACMM,kBAAAA,MAJN,GAIexB,YAAY,CAACE,KAAK,CAACuB,KAAN,CAAYC,SAAb,CAJ3B;AAKAzB,kBAAAA,MAAM,CAAC0B,SAAP,CAAiBH,MAAjB;AACAV,kBAAAA,QAAQ,GAAG,IAAX;AACAI,kBAAAA,IAAI,CAAC;AAAEK,oBAAAA,IAAI,EAAEP,EAAE,CAACO,IAAH,IAAW;AAAnB,mBAAD,CAAJ;AACH,iBARD,CAQE,OAAOK,KAAP,EAAc;AACZnB,kBAAAA,IAAI,CAACoB,OAAL,GAAeC,IAAf,CAAoB,YAAM;AACtBlB,oBAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACH,mBAFD;AAGAT,kBAAAA,sBAAsB;AACtBc,kBAAAA,IAAI,2BAAoBF,EAAE,CAACO,IAAvB,EAAJ;AACH;AACJ;AACJ,aAtBD,MAsBO;AACHT,cAAAA,QAAQ,GAAG,KAAX;;AACA,kBAAIE,EAAE,CAACO,IAAH,KAAY,QAAhB,EAA0B;AACtBL,gBAAAA,IAAI;AACP,eAFD,MAEO;AACHA,gBAAAA,IAAI,2BAAoBF,EAAE,CAACO,IAAvB,EAAJ;AACH;AACJ;;AAhCa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA;AAmCAtB,MAAM,CAAC8B,SAAP,CAAiB,YAAM;AACnBhC,EAAAA,UAAU,CAACiC,MAAX;AACH,CAFD","sourcesContent":["import { LoadingBar } from 'view-design'\nimport createRoutes from '@/utils/createRoutes'\nimport router from './router'\nimport store from './store'\nimport { getDocumentTitle, resetTokenAndClearUser } from './utils'\nimport cloudbase from '@cloudbase/js-sdk'\n\n// 是否有菜单数据\n\nconst app = cloudbase.init({\n    env: 'test-7ggypkpn0dd471ba',\n})\nconst auth = app.auth({\n    persistence: 'local',\n})\nif (auth.hasLoginState()) {\n    console.log('haslogin')\n    // 此时已经登录\n} else {\n    console.log('has not login')\n}\n\nlet hasMenus = false\nrouter.beforeEach(async (to, from, next) => {\n    document.title = getDocumentTitle(to.meta.title)\n    LoadingBar.start()\n    if (auth.hasLoginState()) {\n        if (to.path === '/login') {\n            next({ path: '/' })\n        } else if (hasMenus) {\n            next()\n        } else {\n            try {\n                // 这里可以用 await 配合请求后台数据来生成路由\n                // const data = await axios.get('xxx')\n                // const routes = createRoutes(data)\n                const routes = createRoutes(store.state.menuItems)\n                router.addRoutes(routes)\n                hasMenus = true\n                next({ path: to.path || '/' })\n            } catch (error) {\n                auth.signOut().then(() => {\n                    console.log(\"sign out\")\n                })\n                resetTokenAndClearUser()\n                next(`/login?redirect=${to.path}`)\n            }\n        }\n    } else {\n        hasMenus = false\n        if (to.path === '/login') {\n            next()\n        } else {\n            next(`/login?redirect=${to.path}`)\n        }\n    }\n})\n\nrouter.afterEach(() => {\n    LoadingBar.finish()\n})"]}]}