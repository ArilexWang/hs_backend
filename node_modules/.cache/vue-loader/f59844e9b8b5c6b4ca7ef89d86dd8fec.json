{"remainingRequest":"/Users/alex/Documents/BasketballPark/basketballbackend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/alex/Documents/BasketballPark/basketballbackend/src/views/Date.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/alex/Documents/BasketballPark/basketballbackend/src/views/Date.vue","mtime":1665229325132},{"path":"/Users/alex/Documents/BasketballPark/basketballbackend/node_modules/cache-loader/dist/cjs.js","mtime":1662170097529},{"path":"/Users/alex/Documents/BasketballPark/basketballbackend/node_modules/babel-loader/lib/index.js","mtime":1662170097912},{"path":"/Users/alex/Documents/BasketballPark/basketballbackend/node_modules/cache-loader/dist/cjs.js","mtime":1662170097529},{"path":"/Users/alex/Documents/BasketballPark/basketballbackend/node_modules/vue-loader/lib/index.js","mtime":1662170098083}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldERhdGFXaXRoSWQsIGdldENvbGxlY3Rpb25zV2l0aFBhcmFtIH0gZnJvbSAiQC9hcGkiOwppbXBvcnQgeyBjYWxsQ2xvdWRGdW5jdGlvbiB9IGZyb20gIi4uL2FwaSI7CmltcG9ydCB2dWUgZnJvbSAiLi4vbWFpbi5qcyI7Cgpjb25zdCBkYiA9IHZ1ZS4kYXBwLmRhdGFiYXNlKCk7CmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJkYXRlIiwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcGlja2VyT3B0aW9uczogewogICAgICAgICAgICAgICAgLy8gZGlzYWJsZWREYXRlKHRpbWUpIHsKICAgICAgICAgICAgICAgIC8vICAgcmV0dXJuIHRpbWUuZ2V0VGltZSgpID4gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbHVlOiBuZXcgRGF0ZShuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpKSwKICAgICAgICAgICAgcGVyaW9kOiBbXSwKICAgICAgICAgICAgaGFzUmVwZWF0Q291cnQ6IGZhbHNlCiAgICAgICAgfTsKICAgIH0sCiAgICBhc3luYyBjcmVhdGVkKCkgewogICAgICAgIHRoaXMuJGRhdGEuaGFzUmVwZWF0Q291cnQgPSBmYWxzZTsKICAgICAgICB0aGlzLiRkYXRhLnBlcmlvZCA9IGF3YWl0IHRoaXMuZ2V0UGVyaW9kKHRoaXMuJGRhdGEudmFsdWUpOwogICAgfSwKICAgIGFzeW5jIG1vdW50ZWQoKSB7CiAgICAgICAgY29uc29sZS5sb2coIm1vdXRlZCIpOwogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBhc3luYyBvblBpY2soKSB7CiAgICAgICAgICAgIHRoaXMuJGRhdGEuaGFzUmVwZWF0Q291cnQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy4kZGF0YS5wZXJpb2QgPSBhd2FpdCB0aGlzLmdldFBlcmlvZCh0aGlzLiRkYXRhLnZhbHVlKTsKICAgICAgICB9LAogICAgICAgIGFzeW5jIGdldFBlcmlvZChkYXRlKSB7CiAgICAgICAgICAgIGNvbnN0IHdlZWsgPSBhd2FpdCBnZXREYXRhV2l0aElkKCJ3ZWVrIiwgZGF0ZS5nZXREYXkoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgY29uc3QgcGVyaW9kID0gW107CiAgICAgICAgICAgIHdlZWsuZGF0YVswXS5wZXJpb2QuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBEaWMgPSB7fTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHRoaXMuJGRhdGEudmFsdWUudmFsdWVPZigpKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5zZXRIb3VycyhlbGVtZW50LnN0YXJ0SG91cik7CiAgICAgICAgICAgICAgICBzdGFydERhdGUuc2V0TWludXRlcyhlbGVtZW50LnN0YXJ0TWludXRlKTsKICAgICAgICAgICAgICAgIHRlbXBEaWMuc3RhcnQgPSBzdGFydERhdGU7CiAgICAgICAgICAgICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUodGhpcy4kZGF0YS52YWx1ZS52YWx1ZU9mKCkpOwogICAgICAgICAgICAgICAgZW5kRGF0ZS5zZXRIb3VycyhlbGVtZW50LmVuZEhvdXIpOwogICAgICAgICAgICAgICAgZW5kRGF0ZS5zZXRNaW51dGVzKGVsZW1lbnQuZW5kTWludXRlKTsKICAgICAgICAgICAgICAgIHRlbXBEaWMuZGF0ZUZvcm1hdCA9IHRoaXMuJGRhdGVGb3JtYXQoc3RhcnREYXRlLCAiSEg6TU0iKSArICIgLSAiICsgdGhpcy4kZGF0ZUZvcm1hdChlbmREYXRlLCAiSEg6TU0iKTsKICAgICAgICAgICAgICAgIHRlbXBEaWMuY291cnRzID0gW107CiAgICAgICAgICAgICAgICB0ZW1wRGljLmNvdXJ0TmFtZSA9IFtdOwogICAgICAgICAgICAgICAgcGVyaW9kLnB1c2godGVtcERpYyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBzdGFydCA9IGF3YWl0IHRoaXMuZ2V0U3RhcnQodGhpcy4kZGF0YS52YWx1ZSk7CiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZ2V0T3JkZXJzKHRoaXMuJGRhdGEudmFsdWUpOwogICAgICAgICAgICByZXMuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0ciA9IHRoaXMuJGRhdGVGb3JtYXQoZWxlbWVudC5vcmRlck1zZy5zdGFydCwgInl5eXktbW0tZGQgSEg6TU0iKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc3RhcnQuaW5kZXhPZihzdHIpOwogICAgICAgICAgICAgICAgZWxlbWVudC5vcmRlck1zZy5jb3VydHMuZm9yRWFjaChjb3VydCA9PiB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvdXJ0TXNnID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXNWSVApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQudXNlckluZm8ubmlja05hbWUgJiYgZWxlbWVudC51c2VySW5mby5waG9uZU51bSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnRNc2cgPSBjb3VydC5uYW1lICsgIu+8iCIgKyBlbGVtZW50LnVzZXJJbmZvPy5uaWNrTmFtZSArICIgIiArIGVsZW1lbnQudXNlckluZm8/LnBob25lTnVtICsgIu+8iSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC51c2VySW5mby5uaWNrTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnRNc2cgPSBjb3VydC5uYW1lICsgIu+8iCIgKyAiVklQ6aKE5a6aICIgKyBlbGVtZW50LnVzZXJJbmZvPy5uaWNrTmFtZSArICLvvIkiOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQudXNlckluZm8ucGhvbmVOdW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJ0TXNnID0gY291cnQubmFtZSArICLvvIgiICsgIlZJUOmihOWumiAiICsgZWxlbWVudC51c2VySW5mbz8ucGhvbmVOdW0gKyAi77yJIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJ0TXNnID0gY291cnQubmFtZSArICLvvIgiICsgZWxlbWVudC51c2VySW5mbz8ubmlja05hbWUgKyAiICIgKyBlbGVtZW50LnVzZXJJbmZvPy5waG9uZU51bSArICLvvIkiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwZXJpb2RbaW5kZXhdLmNvdXJ0TmFtZS5wdXNoKGNvdXJ0Lm5hbWUpOwogICAgICAgICAgICAgICAgICAgIHBlcmlvZFtpbmRleF0uY291cnRzLnB1c2goY291cnRNc2cpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBwZXJpb2RbaW5kZXhdLmNvdXJ0TmFtZS5zb3J0KCk7CiAgICAgICAgICAgICAgICBwZXJpb2RbaW5kZXhdLmNvdXJ0cy5zb3J0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBwZXJpb2QuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuY291cnROYW1lLm1hcCh2YWx1ZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY291cnROYW1lLmluZGV4T2YodmFsdWUpICE9PSBlbGVtZW50LmNvdXJ0TmFtZS5sYXN0SW5kZXhPZih2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZGF0YS5oYXNSZXBlYXRDb3VydCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVsZW1lbnQuY291cnRzID0gZWxlbWVudC5jb3VydHMuam9pbigiLCAiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBwZXJpb2Q7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZXRTdGFydChkYXRlKSB7CiAgICAgICAgICAgIGNvbnN0IHdlZWsgPSBhd2FpdCBnZXREYXRhV2l0aElkKCJ3ZWVrIiwgZGF0ZS5nZXREYXkoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBbXTsKICAgICAgICAgICAgd2Vlay5kYXRhWzBdLnBlcmlvZC5mb3JFYWNoKGVsZW1lbnQgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUodGhpcy4kZGF0YS52YWx1ZS52YWx1ZU9mKCkpOwogICAgICAgICAgICAgICAgc3RhcnREYXRlLnNldEhvdXJzKGVsZW1lbnQuc3RhcnRIb3VyKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5zZXRNaW51dGVzKGVsZW1lbnQuc3RhcnRNaW51dGUpOwogICAgICAgICAgICAgICAgc3RhcnQucHVzaCh0aGlzLiRkYXRlRm9ybWF0KHN0YXJ0RGF0ZSwgInl5eXktbW0tZGQgSEg6TU0iKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gc3RhcnQ7CiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZXRPcmRlcnMoZGF0ZSkgewogICAgICAgICAgICBsZXQgdG9tb3Jyb3cgPSBuZXcgRGF0ZShkYXRlLnZhbHVlT2YoKSk7CiAgICAgICAgICAgIHRvbW9ycm93LnNldFRpbWUodG9tb3Jyb3cuZ2V0VGltZSgpICsgMjQgKiA2MCAqIDYwICogMTAwMCk7CiAgICAgICAgICAgIGxldCBvcmRlcnMgPSBbXTsKICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Q29sbGVjdGlvbnNXaXRoUGFyYW0oImNvdXJ0T3JkZXJzIiwgewogICAgICAgICAgICAgICAgIm9yZGVyTXNnLnN0YXJ0IjogZGIuY29tbWFuZC5ndGUoZGF0ZSksCiAgICAgICAgICAgICAgICAib3JkZXJNc2cuZW5kIjogZGIuY29tbWFuZC5sdGUodG9tb3Jyb3cpLAogICAgICAgICAgICAgICAgaGFzUmVmdW5kOiBmYWxzZSwKICAgICAgICAgICAgICAgIGlzVklQOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgb3JkZXJzID0gb3JkZXJzLmNvbmNhdChyZXMuZGF0YSk7CiAgICAgICAgICAgIGNvbnN0IHJlczIgPSBhd2FpdCBnZXRDb2xsZWN0aW9uc1dpdGhQYXJhbSgiY291cnRPcmRlcnMiLCB7CiAgICAgICAgICAgICAgICAib3JkZXJNc2cuc3RhcnQiOiBkYi5jb21tYW5kLmd0ZShkYXRlKSwKICAgICAgICAgICAgICAgICJvcmRlck1zZy5lbmQiOiBkYi5jb21tYW5kLmx0ZSh0b21vcnJvdyksCiAgICAgICAgICAgICAgICBpc1ZJUDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgb3JkZXJzID0gb3JkZXJzLmNvbmNhdChyZXMyLmRhdGEpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhvcmRlcnMpOwogICAgICAgICAgICByZXR1cm4gb3JkZXJzOwogICAgICAgIH0KICAgIH0KfTsK"},{"version":3,"sources":["Date.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Date.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"home-container\">\n        <div class=\"home-content\">\n            <el-date-picker\n                v-model=\"value\"\n                align=\"right\"\n                type=\"date\"\n                placeholder=\"选择日期\"\n                :picker-options=\"pickerOptions\"\n                @change=\"onPick\"\n            >\n            </el-date-picker>\n            <el-alert v-if=\"hasRepeatCourt\" title=\"经检测有重复预定的场地，请检查并联系客户！\" type=\"error\"> </el-alert>\n            <el-table :data=\"period\" fit border style=\"\">\n                <el-table-column prop=\"dateFormat\" label=\"时间段\" width=\"150\"> </el-table-column>\n                <el-table-column prop=\"courts\" label=\"已定场地\" width=\"500\"> </el-table-column>\n            </el-table>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { getDataWithId, getCollectionsWithParam } from \"@/api\";\nimport { callCloudFunction } from \"../api\";\nimport vue from \"../main.js\";\n\nconst db = vue.$app.database();\nexport default {\n    name: \"date\",\n    data() {\n        return {\n            pickerOptions: {\n                // disabledDate(time) {\n                //   return time.getTime() > Date.now();\n                // },\n            },\n            value: new Date(new Date().toLocaleDateString()),\n            period: [],\n            hasRepeatCourt: false\n        };\n    },\n    async created() {\n        this.$data.hasRepeatCourt = false;\n        this.$data.period = await this.getPeriod(this.$data.value);\n    },\n    async mounted() {\n        console.log(\"mouted\");\n    },\n    methods: {\n        async onPick() {\n            this.$data.hasRepeatCourt = false;\n            this.$data.period = await this.getPeriod(this.$data.value);\n        },\n        async getPeriod(date) {\n            const week = await getDataWithId(\"week\", date.getDay().toString());\n            const period = [];\n            week.data[0].period.forEach(element => {\n                const tempDic = {};\n                const startDate = new Date(this.$data.value.valueOf());\n                startDate.setHours(element.startHour);\n                startDate.setMinutes(element.startMinute);\n                tempDic.start = startDate;\n                const endDate = new Date(this.$data.value.valueOf());\n                endDate.setHours(element.endHour);\n                endDate.setMinutes(element.endMinute);\n                tempDic.dateFormat = this.$dateFormat(startDate, \"HH:MM\") + \" - \" + this.$dateFormat(endDate, \"HH:MM\");\n                tempDic.courts = [];\n                tempDic.courtName = [];\n                period.push(tempDic);\n            });\n            const start = await this.getStart(this.$data.value);\n            const res = await this.getOrders(this.$data.value);\n            res.forEach(element => {\n                const str = this.$dateFormat(element.orderMsg.start, \"yyyy-mm-dd HH:MM\");\n                const index = start.indexOf(str);\n                element.orderMsg.courts.forEach(court => {\n                    var courtMsg = \"\";\n                    if (element.isVIP) {\n                        if (element.userInfo.nickName && element.userInfo.phoneNum) {\n                            courtMsg = court.name + \"（\" + element.userInfo?.nickName + \" \" + element.userInfo?.phoneNum + \"）\";\n                        } else if (element.userInfo.nickName) {\n                            courtMsg = court.name + \"（\" + \"VIP预定 \" + element.userInfo?.nickName + \"）\";\n                        } else if (element.userInfo.phoneNum) {\n                            courtMsg = court.name + \"（\" + \"VIP预定 \" + element.userInfo?.phoneNum + \"）\";\n                        }\n                    } else {\n                        courtMsg = court.name + \"（\" + element.userInfo?.nickName + \" \" + element.userInfo?.phoneNum + \"）\";\n                    }\n                    period[index].courtName.push(court.name);\n                    period[index].courts.push(courtMsg);\n                });\n                period[index].courtName.sort();\n                period[index].courts.sort();\n            });\n            period.forEach(element => {\n                element.courtName.map(value => {\n                    if (element.courtName.indexOf(value) !== element.courtName.lastIndexOf(value)) {\n                        this.$data.hasRepeatCourt = true;\n                        return value;\n                    }\n                });\n                element.courts = element.courts.join(\", \");\n            });\n            return period;\n        },\n        async getStart(date) {\n            const week = await getDataWithId(\"week\", date.getDay().toString());\n            const start = [];\n            week.data[0].period.forEach(element => {\n                const startDate = new Date(this.$data.value.valueOf());\n                startDate.setHours(element.startHour);\n                startDate.setMinutes(element.startMinute);\n                start.push(this.$dateFormat(startDate, \"yyyy-mm-dd HH:MM\"));\n            });\n            return start;\n        },\n        async getOrders(date) {\n            let tomorrow = new Date(date.valueOf());\n            tomorrow.setTime(tomorrow.getTime() + 24 * 60 * 60 * 1000);\n            let orders = [];\n            const res = await getCollectionsWithParam(\"courtOrders\", {\n                \"orderMsg.start\": db.command.gte(date),\n                \"orderMsg.end\": db.command.lte(tomorrow),\n                hasRefund: false,\n                isVIP: false\n            });\n            orders = orders.concat(res.data);\n            const res2 = await getCollectionsWithParam(\"courtOrders\", {\n                \"orderMsg.start\": db.command.gte(date),\n                \"orderMsg.end\": db.command.lte(tomorrow),\n                isVIP: true\n            });\n            orders = orders.concat(res2.data);\n            console.log(orders);\n            return orders;\n        }\n    }\n};\n</script>\n"]}]}